---
layout: post
title: Сделать обязательным полем клиенты (контакты) Bitrix24 CRM в сделках.
---

*И так, проблема.*
Есть сущность сделка в CRM. Нужно сделать так чтобы при создании и редактирования сделок, была проверка на обязательное
содержание клиентов, т.е. "Компании" или "Контакты". Без этого сделка не правильна.

*Решение.*
Добавим один обработчик **onBeforeCrmDealAddAndUpdate**, на два события, это добавления и редактирования сделок.

<script src="https://gist.github.com/davletyarov/16bc4e9b0c8b0645e42818ecbc81679f.js"></script>

В самом хэндлере опишем так:

<script src="https://gist.github.com/davletyarov/085ea91a86361576b6a5f079cfdbce9e.js"></script>

И все. Теперь без явного указания клиента, сделка в CRM не зафиксируется, а старые при редактирования придется дополнить.

**Заметка!!!**

Если не перебить, штатный мессэдж об ошибке, то при попытке добавления (редактирования) сделки без "Клиента" получим ошибку:
**Создание сделки отменено обработчиком события:**
![Штатный текст об ошибке](/images/error-message-deal.png)

и вот после перебивки

![Новый текст об ошибке](/images/new-error-message-deal.png)


